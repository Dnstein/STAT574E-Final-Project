---
title: "Idado Pines Mortality Analysis"
output: html_document
date: "2024-11-15"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Libraries:

```{r, message = FALSE}
library(ggmap)
library(readr)
library(ggmap)
library(viridis)
library(spmodel)
```

Get data/maps:

```{r, message = FALSE}
#Read in FIA data
pines <- read_csv("STAT574E-Final-Project/data/pines_plotsdat.csv")

#Get map for all of Idaho
idaho_bbox <- c(-117.25,41.9,-110.95,49.05)
idaho_map <- get_stadiamap(bbox = idaho_bbox, zoom = 7)

#Get map focused on area of study
forest_bbox <- c(-117.25,45,-114,47.5)
forest_map <- get_stadiamap(bbox = forest_bbox, zoom = 9)
```

Plots for exploration/visual assessment:

```{r}
#Simple statewide map to orient the project
ggmap(idaho_map) +
  geom_point(aes(x = LON, y = LAT), data = data.frame(pines))

#Points sized/colored by proportion dead
ggmap(forest_map) +
  geom_point(aes(x = LON, y = LAT, color = DEADPROP, size = DEADPROP), data = data.frame(pines))  +
  scale_color_viridis(option = "inferno", direction = -1) 

#Size data points by proportion dead, color by temp
ggmap(forest_map) +
  geom_point(aes(x = LON, y = LAT, color = temp, size = DEADPROP), data = data.frame(pines))  +
  scale_color_viridis(option = "rocket", direction = -1) 

#Size data points by proportion dead, color by precip
ggmap(forest_map) +
  geom_point(aes(x = LON, y = LAT, color = precip, size = DEADPROP), data = data.frame(pines))  +
  scale_color_viridis(direction = -1) 

#Plot agent data

    #Need a little more data wrangling here? Thinking binary agent columns, and just want to  make sure all NA's would be 0's.

#Size data points by proportion dead, color by competition
ggmap(forest_map) +
  geom_point(aes(x = LON, y = LAT, color = BALIVE, size = DEADPROP), data = data.frame(pines))  +
  scale_color_viridis(option = "mako", direction = -1) 
```

Model fitting:

Mortality ~ population_density + fire_exposure + insect_exposure + disease_exposure + MAT + MAP + spatial random effect

```{r}
#Since we need to limit our response variable to between 0 and 1, define some transformations 
logit <- function(x) log(x / (1 - x))
expit <- function(x) 1 / (1 + exp(-x))

#Transforming data so we can work in the transformed space without infinite values, see generalized_response slides page 31
pines$DEADPROP_adj <- pines$DEADPROP
#Replace observations of none dead with 0.01
pines$DEADPROP_adj[pines$DEADPROP == 0] <- 0.01
#Replace observations of all dead with 0.99
pines$DEADPROP_adj[pines$DEADPROP == 1] <- 0.99

#Transform data into new column
pines$logit_DEADPROP_adj <- logit(pines$DEADPROP_adj)

#Intercept-only model
intercept_formula_transform <- logit_DEADPROP ~ 1

#Competition
competition_formula_transform <- logit_DEADPROP ~ BALIVE

#Fire, insect, disease with and without interactions



#MAT and MAP with interactions
logit_climaten_formula <- logit_DEADPROP ~ precip * temp

#Combined model
```

Model diagnostics:

```{r}
#Residual plots

#AIC

#loocv
```
